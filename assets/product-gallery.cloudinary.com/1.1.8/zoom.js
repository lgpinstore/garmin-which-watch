/*!
 * Cloudinary --> Product Gallery Widget
 * build: 1.1.8
 * ** /
 */
"use strict";(self.webpackChunk_cld_gallery_widget=self.webpackChunk_cld_gallery_widget||[]).push([[312],{9593:function(t,o,e){e.r(o),e.d(o,{default:function(){return D}});var i=e(4942),s=e(6400),n=e(9748),r=e(5335),p=e(6281),h=e(390),l=e(5758),a=e(1973),c=e(6747),d=e(2071),u=e(1407);const m=(0,r.ZP)("div")`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
`,g=(0,r.ZP)("div",{shouldForwardProp:t=>!(!(0,u.Z)(t)&&"touch-action"!=t)&&t})`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
  user-select: none;
  touch-action: ${t=>t["touch-action"]} !important;
`;var f=e(7927),w=e(9280),Z=(0,p.l)((t=>{const o=t.context.config,e=o.selectZoomPropsShowTip(),i=!(e===h.TipShow.NEVER||a.T&&e===h.TipShow.DESKTOP||!a.T&&e===h.TipShow.TOUCH),n=(0,r.iv)({backgroundColor:(0,f._)(o.selectTipPropsColor(),o.selectTipPropsOpacity()),color:o.selectTipPropsTextColor(),padding:"8px 12px",borderRadius:o.selectTipPropsRadius(),margin:a.T?"12px":"46px",fontSize:"1.3em"});return i?(0,s.h)(w.d,{"data-test":"zoom-media-icon-wrap",absolute:!0,className:(0,r.iv)({flexDirection:"column",opacity:t.isZoomed?0:1,transition:"opacity .25s ease-in",borderRadius:o.selectTipPropsRadius(),justifyContent:o.selectZoomPropsTipPosition()===h.TipPosition.BOTTOM?"flex-end":o.selectZoomPropsTipPosition()===h.TipPosition.TOP?"flex-start":"center"})},(0,s.h)("div",{className:n,"data-test":"tip-wrap"},a.T?o.selectZoomPropsTipTouchText():o.selectZoomPropsTipText())):null}));const P=(0,r.ZP)("div")`
  position: absolute;
  width: ${t=>t.width}px;
  height: ${t=>t.height}px;
  border-radius: ${t=>t.radius}px;
  ${t=>t.zIndex?`z-index:${t.zIndex}`:""};
  ${t=>t.renderToContainer?"":"overflow: hidden;"};
`,x=(0,r.ZP)("img")`
  position: absolute;
  translate: -50% -50%;
  inset: 50%;
  opacity: 0;
`;function v(t,o){return o<=0?0:t<-o?-o:t>o?o:t}var z=t=>{const[o,e]=(0,n.eJ)({}),[i,r]=(0,n.eJ)({}),[p,h]=(0,n.eJ)({});(0,n.d4)((()=>{const e=(i.x*t.level-o.x)/2,s=(i.y*t.level-o.y)/2;h({x:e,y:s})}),[o,i,t.level]);const l={backgroundColor:t.zoomed?t.bgColor:"transparent",left:`${t.left}px`,top:`${t.top}px`,transition:"background-color 150ms"},a={width:`${t.width}px`,height:`${t.height}px`,maxWidth:"none",maxHeight:"none",objectFit:"contain",...t.transition&&{transition:"all 150ms"},...t.zoomed&&{width:t.width*t.level+"px",height:t.height*t.level+"px",opacity:1,translate:`\n        calc(-50% - ${v(t.lensLeft*t.level,p.x)}px)\n        calc(-50% - ${v(t.lensTop*t.level,p.y)}px)\n      `}};return(0,s.h)(P,{"data-test":"zoom-flyout-wrap",width:t.width,height:t.height,level:t.level,radius:t.radius,zIndex:t.zIndex,spacing:t.spacing,renderToContainer:t.renderToContainer,style:l},(0,s.h)(x,{itemprop:"image",src:t.url,style:a,alt:t.alt,level:t.level,onLoad:t=>{const o=t.target;if(!o)return;const i=o.offsetParent,s=o.naturalWidth/o.naturalHeight;let n,p;i.offsetWidth/i.offsetHeight>s?(n=i.offsetHeight*s,p=i.offsetHeight):(n=i.offsetWidth,p=i.offsetWidth/s),e({x:i.offsetWidth,y:i.offsetHeight}),r({x:n,y:p})}}))},T=e(7462),y=e(9631);const C=(0,r.ZP)("div")`
  width: ${t=>t.width}px;
  height: ${t=>t.height}px;
  border-radius: ${t=>t.radius}px;
  inset: 50%;
  opacity: 0;
  position: absolute;
  background-color: ${t=>(0,f._)(t.color,t.opacity)};
  ${t=>t.shadow?"box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);":""};
  ${t=>t.borderWidth>0?`border: ${t.borderWidth}px solid ${t.borderColor};`:""};
`;var I=(0,p.l)((t=>{const o=t.context.config,e=(0,y.A8)("lens",o.selectZoomProps()),i=t.show?{opacity:1,translate:`calc(-50% + ${t.left}px) calc(-50% + ${t.top}px)`}:{};return(0,s.h)(C,(0,T.Z)({"data-test":"zoom-lens",width:t.width,height:t.height,radius:t.radius,style:i},e))})),b=e(5074);const O=(0,r.ZP)("div")`
  display: flex;
  position: absolute;
  bottom: 2%;
  gap: 0.5em;
`,S=(0,r.ZP)(b.Z)`
  z-index: 1;
`;var M=t=>(0,s.h)(O,null,(0,s.h)(S,(0,T.Z)({},t,{direction:"left",size:h.ButtonSizes.MD,navigation:h.Navigation.ALWAYS,icon:"zoomOut",disabled:0===t.currentStep,onClick:t.zoomOut})),(0,s.h)(S,(0,T.Z)({},t,{direction:"right",size:h.ButtonSizes.MD,navigation:h.Navigation.ALWAYS,icon:"zoomIn",disabled:t.currentStep>=t.steps,onClick:t.zoomIn})));class $ extends s.wA{constructor(...t){super(...t),(0,i.Z)(this,"state",{steps:0}),(0,i.Z)(this,"calcMultiZoomSteps",(async()=>{const{level:t,steps:o,context:e}=this.props,i=e.config.selectLogErrors();try{var s,n;const r=await e.cloudinary.getAssetInfo(null===(s=this.props)||void 0===s||null===(n=s.asset)||void 0===n?void 0:n.publicId);if(r&&r.input){const e=r.input.width,s=((t,o,e)=>{const i=window.innerWidth;let s=o;if(e)for(;Math.pow(t,s)*i>e&&s>0;)s--;else console.warn("Could not retrieve original image dimensions");return s})(t,o,e);this.setState({steps:s}),i&&o>0&&0===s&&console.warn(`Original asset size does not allow for extra zoom levels. [asset width: ${e}px]`)}}catch(t){i&&console.error(t)}})),(0,i.Z)(this,"zoomIn",(()=>{const t=this.props.currentStep+1;0==this.props.currentStep?this.props.zoomIn():this.props.setMultiZoom(t)})),(0,i.Z)(this,"zoomOut",(()=>{const t=this.props.currentStep-1;0===t?this.props.zoomOut():this.props.setMultiZoom(t)}))}componentDidMount(){this.calcMultiZoomSteps()}render(t,o){const e=this.props.stepLimit?o.steps:t.steps,i=Math.pow(this.props.level,this.props.steps);return!a.T&&e>0&&i>1?(0,s.h)(M,(0,T.Z)({},t.context.config.selectNavigationButtonProps(),{currentStep:t.currentStep,steps:e,zoomIn:this.zoomIn,zoomOut:this.zoomOut})):null}}var k=(0,p.l)($);class L extends n.Vx{constructor(...t){super(...t),(0,i.Z)(this,"state",{left:0,top:0,isZoomed:!1,transition:!1,zoomStep:0}),(0,i.Z)(this,"isInline",(()=>h.ZoomType.INLINE===this.props.type&&!this.props.viewerContainer)),(0,i.Z)(this,"isPopup",(()=>!this.props.inPopup&&h.ZoomType.POPUP===this.props.type&&!this.props.viewerContainer)),(0,i.Z)(this,"isMultiZoom",(()=>this.props.inPopup&&this.props.context.config.selectZoomPropsSteps()>0)),(0,i.Z)(this,"handleEsc",(t=>{"Escape"!==t.key||this.isPopup()||(t.preventDefault(),this.zoomOut())})),(0,i.Z)(this,"getCurrentAsset",(()=>{const t=this.props.context.config.selectMediaAssets(),o=this.props.asset||t[this.props.index]||t.find((t=>t.publicId===this.props.publicId));return o.assets&&(o.publicId=o.assets[0].publicId),o})),(0,i.Z)(this,"getCursorPos",(t=>{let o,e=this.state.left,i=this.state.top;return(t=t||window.event)&&t.isTrusted&&(e=(0,d.jM)(t),i=(0,d.hT)(t),o=this.wrapper.getBoundingClientRect(),e=e-o.left-window.pageXOffset,i=i-o.top-window.pageYOffset),{x:e,y:i}})),(0,i.Z)(this,"onPointerMove",(t=>{if(t&&t.isTrusted&&this.mouseTracker){t.preventDefault(),this.props.inPopup&&t.stopPropagation();let{x:o,y:e}=this.getCursorPos(t);const i=this.props.context.config.selectZoomPropsLensShadow()?1:0,s=this.getLensCoords();o=(0,l.eA)(o,s.width/2,this.props.width-s.width/2-i),e=(0,l.eA)(e,s.height/2,this.props.height-s.height/2-i),o-=this.props.width/2,e-=this.props.height/2,a.T&&"pointerup"==!t.type&&(o*=-1,e*=-1),this.setState({left:o,top:e})}})),(0,i.Z)(this,"onPointerDown",(t=>{t||(t=new MouseEvent("mousedown",{view:window,bubbles:!0,cancelable:!0})),this.mouseClickTracker=(0,d.CA)(t),this.mouseTracker=(0,d.iV)(t)})),(0,i.Z)(this,"onPointerUp",(t=>{this.mouseClickTracker&&this.mouseClickTracker(t)&&(this.state.isZoomed?this.zoomOut():this.zoomIn(t),a.T&&t.stopPropagation())})),(0,i.Z)(this,"onPointerOver",(t=>{this.props.trigger===h.ZoomTrigger.HOVER&&this.zoomIn(t)})),(0,i.Z)(this,"onPointerOut",(t=>{(t.offsetX>=this.props.width||t.offsetX<0||t.offsetY>=this.props.height||t.offsetY<0)&&this.zoomOut()})),(0,i.Z)(this,"getWrapperCoords",(()=>{if(!this.state.isZoomed&&!this.state.transition)return this.isInline()||this.isMultiZoom()?{x:0,y:0}:{x:-1e6,y:-1e6};if(this.wrapper&&!this.props.viewerContainer){const{height:t,width:o,context:e}=this.props,i=this.props.viewerPosition,s=e.config.selectZoomPropsViewerOffset(),n=this.wrapper.getBoundingClientRect(),r=window.pageXOffset,p=window.pageYOffset,l=e.config.selectDisplayPropsMode(),a=e.config.selectDisplayPropsSpacing(),c=e.config.selectDisplayPropsColumns(),d=l===h.DisplayMode.EXPANDED&&c>1?a:s;let u,m;return u=this.isInline()||this.isMultiZoom()?0:i===h.ZoomViewerPosition.BOTTOM?p+n.top+t+d:i===h.ZoomViewerPosition.TOP?p+n.top-t-d:n.top+p,m=this.isInline()||this.isMultiZoom()?0:i===h.ZoomViewerPosition.RIGHT?r+n.right+d:i===h.ZoomViewerPosition.LEFT?r+n.left-o-d:n.left+r,{y:u,x:m}}return{y:0,x:0}})),(0,i.Z)(this,"getLensCoords",(()=>{const t=Math.max(1,this.state.zoomStep);return{width:this.props.width/(this.props.level*t),height:this.props.height/(this.props.level*t)}})),(0,i.Z)(this,"zoomIn",(t=>{this.setState({isZoomed:!0,zoomStep:1}),this.props.setZoom&&!this.isMultiZoom()&&this.props.setZoom(this.props.index),this.isPopup()||this.setTransition(),t?this.onPointerMove(t):this.onPointerDown(),this.props.context.events(c.z.ZOOM_IN,this.props.publicId),this.props.onZoomIn&&this.props.onZoomIn(),document.body.addEventListener("keydown",this.handleEsc)})),(0,i.Z)(this,"zoomOut",(()=>{this.setTransition(),this.setState({isZoomed:!1,zoomStep:0}),this.props.onZoomOut&&this.props.onZoomOut(),!this.props.setZoom||this.isPopup()||this.isMultiZoom()||this.props.setZoom(-1),this.props.context.events(c.z.ZOOM_OUT,this.props.publicId),document.body.removeEventListener("keydown",this.handleEsc)})),(0,i.Z)(this,"setMultiZoom",(t=>{this.setTransition(),this.setState({zoomStep:t,left:0,top:0})})),(0,i.Z)(this,"setTransition",(()=>{this.setState({transition:!0}),setTimeout((()=>{this.state.transition&&this.setState({transition:!1})}),150)})),(0,i.Z)(this,"setContainerStyles",(()=>{if(this.props.viewerContainer){const t=document.querySelector(this.props.viewerContainer);if(t)if(this.state.isZoomed||this.state.transition){const o=r.iv`
            overflow: hidden;
            width: ${this.props.width}px;
            height: ${this.props.height}px;
            ${t.style.position?"":"position: relative;"};
          `;t.classList.add(this.containerCls=o)}else t.classList.remove(this.containerCls)}}))}componentDidUpdate(t){t.zoomIn!==this.props.zoomIn&&(this.props.zoomIn?(this.zoomIn(),this.onPointerDown()):this.zoomOut())}componentWillUnmount(){this.state.isZoomed&&this.zoomOut(),document.body.removeEventListener("keydown",this.handleEsc)}render(t,o){const{config:e}=t.context,i=t.viewerContainer,r=this.getWrapperCoords(),p=this.getLensCoords(),l=this.isInline()||!this.isInline()&&!this.isPopup()&&!t.inPopup||this.isPopup()&&!t.inPopup||this.isMultiZoom();i&&this.setContainerStyles();const a={zoomed:o.isZoomed,url:t.url,width:t.width,height:t.height,level:Math.pow(t.level,o.zoomStep),top:r.y,left:r.x,lensLeft:o.left,lensTop:o.top,radius:e.selectZoomPropsViewerRadius(),zIndex:!(this.isInline()||this.isMultiZoom())&&e.selectZoomPropsViewerZIndex(),bgColor:e.selectThemePropsPrimary(),spacing:e.selectZoomPropsViewerOffset(),renderToContainer:i,transition:o.transition};return(0,s.h)(m,{innerRef:t=>this.wrapper=t,"data-test":"zoom-wrap"},(0,s.h)(Z,null),this.isInline()||this.isMultiZoom()?(0,s.h)(z,a):null,this.isInline()||this.isPopup()||this.isMultiZoom()?null:(0,n.jz)((0,s.h)(z,a),i&&document.querySelector(i)||document.body),!this.isPopup()&&!this.isMultiZoom()&&(0,s.h)(I,{show:o.isZoomed&&!this.isInline()&&e.selectZoomPropsShowLens(),width:p.width,height:p.height,left:o.left,top:o.top}),(0,s.h)(g,{"data-test":"zoom-trigger",onpointerdown:t.trigger===h.ZoomTrigger.CLICK&&this.onPointerDown,onpointerup:t.trigger===h.ZoomTrigger.CLICK&&this.onPointerUp,onpointermove:o.isZoomed&&!this.isPopup()&&this.onPointerMove,onpointerout:o.isZoomed&&!this.isPopup()&&this.onPointerOut,onpointerover:!this.isPopup()&&this.onPointerOver,"touch-action":o.isZoomed||t.inPopup?"pinch-zoom":"pan-y pinch-zoom",style:{cursor:l?o.isZoomed?"zoom-out":"zoom-in":"default"}}),this.isMultiZoom()&&(0,s.h)(k,{zoomIn:this.zoomIn,zoomOut:this.zoomOut,setMultiZoom:this.setMultiZoom,asset:this.getCurrentAsset(),level:t.level,currentStep:o.zoomStep,steps:e.selectZoomPropsSteps()}))}}var D=(0,p.l)(L)}}]);
//# sourceMappingURL=zoom.js.map